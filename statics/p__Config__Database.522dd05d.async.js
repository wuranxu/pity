"use strict";(self.webpackChunkpity=self.webpackChunkpity||[]).push([[3929],{646:function(F,m,n){var p=n(86738),l=n(85893);m.Z=function(D){var r=D.title,M=D.text,d=D.onConfirm;return(0,l.jsx)(p.Z,{title:r,onConfirm:d,children:(0,l.jsx)("a",{children:M})})}},37594:function(F,m,n){n.d(m,{B:function(){return D}});var p=n(91321),l="//at.alicdn.com/t/font_915840_2b8lahxt5xv.js",D=(0,p.Z)({scriptUrl:l})},84298:function(F,m,n){var p=n(97857),l=n.n(p),D=n(5574),r=n.n(D),M=n(67294),d=n(58131),I=n(69400),P=n(15746),g=n(76081),c=n(85893),O=d.Z.Item,C=function(u){var A=u.title,j=u.width,$=u.left,V=u.right,b=u.formName,h=u.record,W=u.onFinish,w=u.loading,N=u.fields,Q=u.open,L=u.onCancel,Z=u.offset,z=Z===void 0?0:Z,R=u.children,K=u.Footer,U=u.onTest,G=d.Z.useForm(),Y=r()(G,1),e=Y[0],x=function(){e.validateFields().then(function(f){W(f)})};(0,M.useEffect)(function(){e.resetFields(),e.setFieldsValue(h)},[h]);var H={labelCol:{span:$},wrapperCol:{span:V}};return(0,c.jsxs)(I.Z,{style:{marginTop:z},confirmLoading:w,footer:K!==void 0?(0,c.jsx)(K,{onOk:x,onCancel:L,onTest:function(){e.validateFields().then(function(f){U(f)})}}):void 0,title:A,width:j,open:Q,onOk:x,onCancel:L,children:[R||null,(0,c.jsx)(d.Z,l()(l()({form:e},H),{},{name:b,initialValues:h,onFinish:W,children:N.map(function(i,f){return(0,c.jsx)(P.Z,{span:i.span||24,children:(0,c.jsx)(O,{label:i.label,colon:i.colon||!0,initialValue:i.initialValue,rules:[{required:i.required,message:i.message}],name:i.name,valuePropName:i.valuePropName||"value",children:(0,g.Z)(i.type,i.placeholder,i.component)})},f)})}))]})};m.Z=C},76081:function(F,m,n){var p=n(96365),l=n(72269),D=n(67294),r=n(85893),M=p.Z.TextArea,d=function(P,g){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return c||(P==="input"?(0,r.jsx)(p.Z,{placeholder:g}):P==="textarea"?(0,r.jsx)(M,{placeholder:g}):P==="switch"?(0,r.jsx)(l.Z,{}):null)};m.Z=d},46580:function(F,m,n){n.r(m);var p=n(97857),l=n.n(p),D=n(15009),r=n.n(D),M=n(99289),d=n.n(M),I=n(5574),P=n.n(I),g=n(58841),c=n(34041),O=n(58131),C=n(51904),S=n(96074),u=n(96365),A=n(53575),j=n(71577),$=n(4393),V=n(99138),b=n(71230),h=n(15746),W=n(64240),w=n(18429),N=n(8751),Q=n(40110),L=n(33160),Z=n(51042),z=n(94171),R=n(67294),K=n(84298),U=n(19478),G=n(646),Y=n(37594),e=n(85893),x=c.Z.Option,H={labelCol:{span:8},wrapperCol:{span:16}},i=function(y){var v=y.dispatch,B=y.gconfig,se=y.loading,re=O.Z.useForm(),ue=P()(re,1),J=ue[0],_e=(0,R.useState)(null),ee=P()(_e,2),X=ee[0],ne=ee[1],ae=B.envList,oe=B.envMap,le=B.databaseModal,ie=B.dbConfigData,k=B.databaseRecord,de=se.effects,q=function(s){v({type:"gconfig/save",payload:s})},te=function(){var t=d()(r()().mark(function s(a){var _;return r()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,v({type:"gconfig/onTestDbConfig",payload:{sql_type:a.sql_type,host:a.host,port:a.port,username:a.username,password:a.password,database:a.database}});case 2:_=o.sent,ne(_);case 4:case"end":return o.stop()}},s)}));return function(a){return t.apply(this,arguments)}}(),ce=function(){var t=d()(r()().mark(function s(){return r()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return v({type:"gconfig/fetchEnvList",payload:{page:1,size:1e4}}),_.next=3,T();case 3:case"end":return _.stop()}},s)}));return function(){return t.apply(this,arguments)}}(),T=function(){var t=d()(r()().mark(function s(){var a,_;return r()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,J.getFieldsValue();case 2:a=o.sent,_={name:a.name||"",database:a.database||""},a.env&&(_.env=a.env),v({type:"gconfig/fetchDbConfig",payload:l()({},_)});case 6:case"end":return o.stop()}},s)}));return function(){return t.apply(this,arguments)}}();(0,R.useEffect)(function(){ce()},[]);var Ee=[{title:"\u73AF\u5883",key:"env",dataIndex:"env",render:function(s){return(0,e.jsx)(C.Z,{children:oe[s]})}},{title:"\u540D\u79F0",key:"name",dataIndex:"name"},{title:"\u5730\u5740",key:"host",dataIndex:"host"},{title:"\u5E93\u540D",key:"database",dataIndex:"database"},{title:"\u7AEF\u53E3\u53F7",key:"port",dataIndex:"port"},{title:"\u5E10\u53F7",key:"username",dataIndex:"username"},{title:"\u5BC6\u7801",key:"password",dataIndex:"password"},{title:"\u7C7B\u578B",key:"sql_type",dataIndex:"sql_type",render:function(s){return s===0?(0,e.jsx)(C.Z,{color:"blue",children:"MySQL"}):s===1?(0,e.jsx)(C.Z,{color:"success",children:"Postgresql"}):(0,e.jsx)(C.Z,{children:"\u672A\u77E5"})}},{title:"\u64CD\u4F5C",key:"ops",render:function(s,a){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("a",{onClick:function(){q({databaseRecord:a,databaseModal:!0})},children:"\u7F16\u8F91"}),(0,e.jsx)(S.Z,{type:"vertical"}),(0,e.jsx)("a",{onClick:function(){te(a)},children:"\u6D4B\u8BD5"}),(0,e.jsx)(S.Z,{type:"vertical"}),(0,e.jsx)(G.Z,{text:"\u5220\u9664",title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u914D\u7F6E\u5417?",onConfirm:d()(r()().mark(function _(){return r()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,v({type:"gconfig/deleteDbConfig",payload:{id:a.id}});case 2:return o.next=4,T();case 4:case"end":return o.stop()}},_)}))})]})}}],me=function(){var t=d()(r()().mark(function s(a){return r()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(k.id){E.next=5;break}return E.next=3,v({type:"gconfig/insertDbConfig",payload:l()({},a)});case 3:E.next=7;break;case 5:return E.next=7,v({type:"gconfig/updateDbConfig",payload:l()({id:k.id},a)});case 7:return E.next=9,T();case 9:case"end":return E.stop()}},s)}));return function(a){return t.apply(this,arguments)}}(),pe=[{name:"sql_type",label:"\u6570\u636E\u5E93\u7C7B\u578B",required:!0,component:(0,e.jsx)(c.Z,{children:Object.keys(U.Z.SQL_TYPE).map(function(t){return(0,e.jsx)(x,{value:parseInt(t,10),children:U.Z.SQL_TYPE[t]},t)})}),type:"select"},{name:"env",label:"\u73AF\u5883",required:!0,message:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u73AF\u5883",type:"select",component:(0,e.jsx)(c.Z,{children:ae.map(function(t){return(0,e.jsx)(x,{value:t.id,children:t.name},t.id)})}),placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u73AF\u5883"},{name:"name",label:"\u914D\u7F6E\u540D\u79F0",required:!0,message:"\u8BF7\u8F93\u5165\u914D\u7F6E\u540D\u79F0",type:"input",placeholder:"\u8BF7\u8F93\u5165\u914D\u7F6E\u540D\u79F0"},{name:"host",label:"\u5730\u5740",required:!0,message:"\u8BF7\u8F93\u5165host",type:"input",placeholder:"\u8BF7\u8F93\u5165host"},{name:"port",label:"\u7AEF\u53E3",required:!0,message:"\u8BF7\u8F93\u5165port",type:"input",placeholder:"\u8BF7\u8F93\u5165port"},{name:"database",label:"\u5E93\u540D",required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D",type:"input",placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"},{name:"username",label:"\u5E10\u53F7",required:!0,message:"\u8BF7\u8F93\u5165\u5E10\u53F7",type:"input",placeholder:"\u8BF7\u8F93\u5165\u5E10\u53F7"},{name:"password",label:"\u5BC6\u7801",required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",component:(0,e.jsx)(u.Z,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"})}],De=function(s){var a=s.onOk,_=s.onCancel,E=s.onTest;return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{style:{display:"inline-block",lineHeight:"32px",float:"left",marginLeft:4},children:X===null?(0,e.jsx)("span",{children:(0,e.jsx)(A.Z,{status:"default",text:"\u672A\u6D4B\u8BD5\u8FDE\u63A5"})}):(0,e.jsx)(A.Z,{status:X?"success":"error",text:X?"\u6D4B\u8BD5\u8FDE\u63A5\u6210\u529F":"\u6D4B\u8BD5\u8FDE\u63A5\u5931\u8D25"})}),(0,e.jsxs)(j.ZP,{onClick:E,type:"dashed",style:{marginLeft:8},children:[(0,e.jsx)(Y.B,{type:"icon-fasong1"})," \u6D4B\u8BD5\u8FDE\u63A5"]}),(0,e.jsxs)(j.ZP,{onClick:_,style:{marginLeft:8},children:[(0,e.jsx)(w.Z,{})," \u53D6\u6D88"]}),(0,e.jsxs)(j.ZP,{onClick:a,type:"primary",children:[(0,e.jsx)(N.Z,{})," \u786E\u5B9A"]})]})};return(0,e.jsx)(g._z,{title:"\u6570\u636E\u5E93\u914D\u7F6E\u5217\u8868",breadcrumb:null,children:(0,e.jsxs)($.Z,{children:[(0,e.jsx)(K.Z,{Footer:De,onTest:te,record:k,fields:pe,title:"\u6570\u636E\u5E93\u914D\u7F6E",onFinish:me,left:6,right:18,open:le,offset:-50,onCancel:function(){q({databaseModal:!1})},children:(0,e.jsx)(V.Z,{type:"info",style:{marginBottom:12,marginTop:-12},closable:!0,message:"\u{1F942} \u5728\u6DFB\u52A0/\u7F16\u8F91\u6570\u636E\u5E93\u914D\u7F6E\u4E4B\u524D\uFF0C\u8BB0\u5F97\u5148\u6D4B\u8BD5\u8FDE\u63A5\u662F\u5426\u53EF\u7528\u54DF\uFF01"})}),(0,e.jsx)(O.Z,l()(l()({},H),{},{form:J,children:(0,e.jsxs)(b.Z,{gutter:8,children:[(0,e.jsx)(h.Z,{span:6,children:(0,e.jsx)(O.Z.Item,{label:"\u73AF\u5883",name:"env",children:(0,e.jsx)(c.Z,{placeholder:"\u9009\u62E9\u73AF\u5883",allowClear:!0,children:ae.map(function(t){return(0,e.jsx)(x,{value:t.id,children:t.name})})})})}),(0,e.jsx)(h.Z,{span:6,children:(0,e.jsx)(O.Z.Item,{label:"\u914D\u7F6E\u540D",name:"name",children:(0,e.jsx)(u.Z,{placeholder:"\u8F93\u5165\u6570\u636E\u5E93\u914D\u7F6E\u540D"})})}),(0,e.jsx)(h.Z,{span:6,children:(0,e.jsx)(O.Z.Item,{label:"\u6570\u636E\u5E93\u540D",name:"database",children:(0,e.jsx)(u.Z,{placeholder:"\u8F93\u5165\u6570\u636E\u5E93\u540D"})})}),(0,e.jsx)(h.Z,{span:6,children:(0,e.jsxs)("div",{style:{float:"right"},children:[(0,e.jsxs)(j.ZP,{type:"primary",onClick:T,children:[(0,e.jsx)(Q.Z,{}),"\u67E5\u8BE2"]}),(0,e.jsxs)(j.ZP,{style:{marginLeft:8},onClick:d()(r()().mark(function t(){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return J.resetFields(),a.next=3,T();case 3:case"end":return a.stop()}},t)})),children:[(0,e.jsx)(L.Z,{}),"\u91CD\u7F6E"]})]})})]})})),(0,e.jsx)(b.Z,{style:{marginTop:12},children:(0,e.jsxs)(h.Z,{span:24,children:[(0,e.jsx)(b.Z,{style:{marginBottom:16},children:(0,e.jsxs)(j.ZP,{type:"primary",onClick:function(){q({databaseModal:!0,databaseRecord:{sql_type:0}}),ne(null)},children:[(0,e.jsx)(Z.Z,{})," \u6DFB\u52A0\u914D\u7F6E"]})}),(0,e.jsx)(W.Z,{columns:Ee,dataSource:ie,rowKey:function(s){return s.id},loading:de["gconfig/fetchDbConfig"]})]})})]})})};m.default=(0,z.connect)(function(f){var y=f.loading,v=f.gconfig;return{loading:y,gconfig:v}})(i)}}]);
